<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Cards Against Reality — Pack Design Studio (Beta)</title>
  <style>
    :root { --bg:#0f0f13; --panel:#1a1b26; --muted:#9ca1b3; --text:#f7f8ff; --acc:#7c5cff; --good:#1ec987; }
    *{box-sizing:border-box} body{margin:0;font-family:Inter,system-ui;background:var(--bg);color:var(--text)}
    .wrap{max-width:1100px;margin:0 auto;padding:22px}
    .panel{background:var(--panel);border:1px solid #ffffff1a;border-radius:14px;padding:16px;margin-bottom:14px}
    h1,h2,h3{margin:.2rem 0 .6rem} .muted{color:var(--muted);font-size:14px}
    .grid{display:grid;gap:12px}.g2{grid-template-columns:1fr}.g3{grid-template-columns:1fr}
    @media(min-width:900px){.g2{grid-template-columns:1fr 1fr}.g3{grid-template-columns:repeat(3,1fr)}}
    input,select,textarea,button{width:100%;padding:10px;border-radius:10px;border:1px solid #ffffff22;background:#12131c;color:var(--text)}
    textarea{min-height:80px;resize:vertical} button{cursor:pointer} button.primary{background:var(--acc);font-weight:700}
    .cards{display:grid;grid-template-columns:1fr;gap:8px;max-height:380px;overflow:auto}
    .card{padding:10px;border:1px solid #ffffff22;border-radius:10px;background:#11121b}
    .row{display:flex;gap:8px}.row button{width:auto}
    .tag{display:inline-block;font-size:12px;color:#d4ccff;background:#7c5cff22;padding:4px 8px;border-radius:999px}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Cards Against Reality — Pack Design Studio</h1>
    <div class="muted">Build a personalized gift pack. Solo-first creation. Offline reveal ready.</div>

    <div class="panel">
      <h3>1) Pack Brief</h3>
      <div class="grid g2">
        <div><label class="muted">Pack name</label><input id="packName" value="Hank vs Pat Holiday Roast" /></div>
        <div><label class="muted">Occasion</label><select id="occasion"><option>Holiday</option><option>Birthday</option><option>Wedding</option><option>Office Party</option></select></div>
        <div><label class="muted">Tone</label><select id="tone"><option>Balanced</option><option>Savage</option><option>Unhinged</option><option>Wholesome</option></select></div>
        <div><label class="muted">Pack size</label><select id="size"><option value="mini">Mini (20+60)</option><option value="standard" selected>Standard (30+90)</option><option value="deluxe">Deluxe (40+120)</option></select></div>
      </div>
      <div style="margin-top:10px">
        <label class="muted">Inside jokes / lore / people / places</label>
        <textarea id="lore" placeholder="catchphrases, legendary moments, group references"></textarea>
      </div>
      <div class="row" style="margin-top:10px">
        <button id="themeBtn" class="primary">Generate 3 theme ideas</button>
      </div>
    </div>

    <div class="panel">
      <h3>2) Pick a Theme</h3>
      <div id="themes" class="grid g3"></div>
    </div>

    <div class="panel">
      <h3>3) Generate Cards</h3>
      <div class="row">
        <button id="genCards" class="primary">Generate pack cards</button>
        <button id="regen">Regenerate weak cards</button>
      </div>
      <div class="muted" id="stats" style="margin-top:8px">No cards yet.</div>
    </div>

    <div class="grid g2">
      <div class="panel">
        <h3>Prompt Cards (Black)</h3>
        <div id="blackCards" class="cards"></div>
      </div>
      <div class="panel">
        <h3>Response Cards (White)</h3>
        <div id="whiteCards" class="cards"></div>
      </div>
    </div>

    <div class="panel">
      <h3>4) Export</h3>
      <div class="muted">Current beta exports JSON. Printable PDF export is next.</div>
      <div class="row" style="margin-top:8px">
        <button id="exportJson" class="primary">Download Pack JSON</button>
      </div>
    </div>
  </div>

  <script>
    const THEMES = [
      ["Holiday Nuclear", "Festive cheer + maximum roast energy"],
      ["Lorekeeper", "Deep-cut inside jokes only true friends get"],
      ["Corporate Snowglobe", "Office party chaos with plausible deniability"],
      ["Chaotic Nostalgia", "Old memories, no emotional safety"],
      ["Family Dinner Disaster", "Wholesome setup, unhinged outcomes"],
      ["Startup Delusion", "Pitch-deck optimism and sleep deprivation"]
    ];
    const BLACK = [
      "At this holiday party, someone brought ____.",
      "The gift reveal was perfect until ____.",
      "Grandma asked about my career, so I mentioned ____.",
      "Our friend group lore can be summarized by ____.",
      "The only thing keeping this friendship alive is ____.",
      "This custom pack was sponsored by ____.",
      "The secret ingredient in our chaos is ____."
    ];
    const WHITE = [
      "a suspiciously confident group chat admin",
      "an apology drafted by ChatGPT",
      "three coffees and one terrible decision",
      "a conspiracy board made of receipts",
      "a friendship held together by memes",
      "high-effort low-judgment energy",
      "a legendary typo no one forgot"
    ];

    const $ = id => document.getElementById(id);
    let selectedTheme = null;
    let pack = { black: [], white: [] };

    function words(s){ return (s||"").toLowerCase().split(/[^a-z0-9]+/).filter(x=>x.length>3).slice(0,15); }
    function choose(arr){ return arr[Math.floor(Math.random()*arr.length)] }

    function sizeCounts(){
      const v = $("size").value;
      if(v==="mini") return {b:20,w:60};
      if(v==="deluxe") return {b:40,w:120};
      return {b:30,w:90};
    }

    function renderThemes(){
      const host = $("themes"); host.innerHTML = "";
      const picks = [...THEMES].sort(()=>Math.random()-0.5).slice(0,3);
      picks.forEach(([name,desc])=>{
        const el = document.createElement("div");
        el.className = "card";
        el.innerHTML = `<div class="tag">Theme</div><h4>${name}</h4><div class="muted">${desc}</div><button style="margin-top:8px">Use this theme</button>`;
        el.querySelector("button").onclick = ()=>{ selectedTheme = {name,desc}; [...host.children].forEach(c=>c.style.outline="none"); el.style.outline = "2px solid #7c5cff"; };
        host.appendChild(el);
      });
    }

    function generateCards(){
      if(!selectedTheme){ alert("Pick a theme first."); return; }
      const lore = words($("lore").value);
      const {b,w} = sizeCounts();
      pack.black = Array.from({length:b}, (_,i)=> {
        const seed = lore.length ? choose(lore) : "friendship";
        return `${choose(BLACK)} (${selectedTheme.name} #${i+1}: ${seed})`;
      });
      pack.white = Array.from({length:w}, (_,i)=> {
        const seed = lore.length ? choose(lore) : "chaos";
        return `${choose(WHITE)} — ${seed} edition #${i+1}`;
      });
      renderCards();
    }

    function renderCards(){
      const bHost = $("blackCards"), wHost = $("whiteCards");
      bHost.innerHTML = ""; wHost.innerHTML = "";
      pack.black.forEach((c,idx)=>{ const el=document.createElement("div"); el.className="card"; el.textContent=`${idx+1}. ${c}`; bHost.appendChild(el); });
      pack.white.forEach((c,idx)=>{ const el=document.createElement("div"); el.className="card"; el.textContent=`${idx+1}. ${c}`; wHost.appendChild(el); });
      $("stats").textContent = `Generated ${pack.black.length} prompt + ${pack.white.length} response cards (${pack.black.length+pack.white.length} total).`;
    }

    function exportJson(){
      if(!pack.black.length){ alert("Generate cards first."); return; }
      const payload = {
        packName: $("packName").value,
        occasion: $("occasion").value,
        tone: $("tone").value,
        theme: selectedTheme,
        counts: sizeCounts(),
        cards: pack,
        generatedAt: new Date().toISOString()
      };
      const blob = new Blob([JSON.stringify(payload,null,2)], {type:"application/json"});
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = `${($("packName").value||"car-pack").replace(/\s+/g,"-").toLowerCase()}.json`;
      a.click();
      URL.revokeObjectURL(a.href);
    }

    $("themeBtn").onclick = renderThemes;
    $("genCards").onclick = generateCards;
    $("regen").onclick = generateCards;
    $("exportJson").onclick = exportJson;
    renderThemes();
  </script>
</body>
</html>